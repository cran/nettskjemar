<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Building custom requests</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Building custom requests</h1>



<p>This package focuses on retrieving information from the Nettskjema
API, primarily regarding collected data and meta-data for forms. There
are, however, several endpoints (functionalities) of the API that are
currently not covered here. These most often pertain to sending data
<em>to</em> the API, either for creating new forms, updating meta-data
or even submitting submissions.</p>
<p>In order to facilitate users potential wish to connect to these
endpoints too, the base function <code>ns_req()</code> is available to
build the query you are after. This vignette will in short show how you
can combine this function, with functionality from the <a href="https://httr2.r-lib.org/index.html">httr2</a> package to create
custom requests to the Nettskjema API.</p>
<div id="setting-up-a-custom-get-request" class="section level2">
<h2>Setting up a custom GET request</h2>
<p>First, you will need to identify the functionality you want to use in
the <a href="https://nettskjema.no/apidoc">Nettskjema API docs</a>.</p>
<p>Let’s assume you want to update the settings for a form. To do this,
we can first retrieve the settings as they are stored, alter the setting
we want to alter, then send that back to Nettskjema.</p>
<p>In the API docs, the URL for getting Settings for a form is shown as
<code>/api/v3/form/{formId}/settings</code>, which is the URL we need to
build to access this information. The <code>ns_req()</code> function,
will build the URL up to including <code>/api/v3</code> and we need to
add the rest.</p>
<p>The <code>ns_req()</code> function looks like this</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>ns_req <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  httr2<span class="sc">::</span><span class="fu">request</span>(<span class="st">&quot;https://nettskjema.no/api/v3/&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="fu">ns_req_auth</span>(...)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>}</span></code></pre></div>
<p>where <code>ns_auth()</code> is sets up the authentication client as
described in the <a href="authentication.html">Authentication
vignette</a>. Meaning if we use it, the important parts that make sure
you connect to the correct API with the correct credentials.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(nettskjemar)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">ns_req</span>()</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; &lt;httr2_request&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; GET https://nettskjema.no/api/v3/</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; Body: empty</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; Policies:</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; * auth_sign : &lt;list&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; * auth_oauth: TRUE</span></span></code></pre></div>
<p>As you can see, the output here shows the URL until the
<code>v3</code> section, and also that there is Authorization added,
which the function does in the background for you with the
authentication information you have set up as shown in the <a href="authentication.html">Authentication vignette</a>.</p>
<p>From there, we need to use functions from {httr2} to build the
remaining url.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>formid <span class="ot">&lt;-</span> <span class="dv">123823</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">ns_req</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">&quot;form&quot;</span>, formid, <span class="st">&quot;settings&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; &lt;httr2_request&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; GET https://nettskjema.no/api/v3/form/123823/settings</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; Body: empty</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; Policies:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; * auth_sign : &lt;list&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; * auth_oauth: TRUE</span></span></code></pre></div>
<p>Now, you can see that the path is as requested in the API
documentation. But the request has not been submitted yet! So far, we
have just been creating the command we want to send to the API. To send
the request, we need to use the <code>req_perform</code> function from
httr2.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">ns_req</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">&quot;form&quot;</span>, formid, <span class="st">&quot;settings&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>response</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; &lt;httr2_response&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; GET https://nettskjema.no/api/v3/form/123823/settings</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; Status: 200 OK</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; Content-Type: application/json</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; Body: In memory (2047 bytes)</span></span></code></pre></div>
<p>In this case, we also saved the output from the request to a variable
in our environment, so we can work with what we received, without having
to send the request more times.</p>
<p>The <code>response</code> object here shows stats <code>200</code>
which is the standard response when a request has been fulfilled without
error. If you receive errors, httr2 will show this clearly, and you will
need to debug what is wrong.</p>
<p>Now that we have the response, we need to “unpack” it, so we can get
the data that was sent with the response, which are all the settings for
the form. We use httr2 functions to do this. In general, most of the
Nettskjema API responses come as <code>json</code> in the “body” of the
response (this is API lingo, just go with it.).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>settings_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(response)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>settings_data</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; $formId</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; [1] 123823</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; $formType</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;DEFAULT&quot;</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; $scoreResultDisplayType</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;NONE&quot;</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; $openFrom</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2023-06-01T20:55:49&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; $openTo</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2024-06-02T02:00:02&quot;</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; $title</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; [1] &quot;API test form&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; $titleShort</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt; $editorsContactEmail</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a.m.mowinckel@psykologi.uio.no&quot;</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt; $editorsContactUrl</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">#&gt; $collectsPersonalData</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="co">#&gt; $sensitivePersonalDataCollected</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="co">#&gt; $personalDataSharedOutsideInstitutionWith</span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="co">#&gt; $personalDataPurposeTypes</span></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a><span class="co">#&gt; $personalDataPurposeTypes[[1]]</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a><span class="co">#&gt; [1] &quot;OTHER&quot;</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a><span class="co">#&gt; $personalDataPurposeDescription</span></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Testing the API&quot;</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a><span class="co">#&gt; $languageCode</span></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a><span class="co">#&gt; [1] &quot;nb&quot;</span></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a><span class="co">#&gt; $shouldHideProgressBar</span></span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a><span class="co">#&gt; $shouldPreventDataManipulation</span></span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a><span class="co">#&gt; $codebookActivated</span></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a><span class="co">#&gt; $afterDeliveryForwardFormIds</span></span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-61"><a href="#cb5-61" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-62"><a href="#cb5-62" tabindex="-1"></a><span class="co">#&gt; $maxSubmissionsForm</span></span>
<span id="cb5-63"><a href="#cb5-63" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-64"><a href="#cb5-64" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-65"><a href="#cb5-65" tabindex="-1"></a><span class="co">#&gt; $maxSubmissionsPerson</span></span>
<span id="cb5-66"><a href="#cb5-66" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb5-67"><a href="#cb5-67" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-68"><a href="#cb5-68" tabindex="-1"></a><span class="co">#&gt; $canNotAnswerMessage</span></span>
<span id="cb5-69"><a href="#cb5-69" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-70"><a href="#cb5-70" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-71"><a href="#cb5-71" tabindex="-1"></a><span class="co">#&gt; $respondentGroup</span></span>
<span id="cb5-72"><a href="#cb5-72" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ALL&quot;</span></span>
<span id="cb5-73"><a href="#cb5-73" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-74"><a href="#cb5-74" tabindex="-1"></a><span class="co">#&gt; $deleteSubmissionsAfterNumberOfDays</span></span>
<span id="cb5-75"><a href="#cb5-75" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-76"><a href="#cb5-76" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-77"><a href="#cb5-77" tabindex="-1"></a><span class="co">#&gt; $postponable</span></span>
<span id="cb5-78"><a href="#cb5-78" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-79"><a href="#cb5-79" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-80"><a href="#cb5-80" tabindex="-1"></a><span class="co">#&gt; $retainRespondentAccessAfterDelivery</span></span>
<span id="cb5-81"><a href="#cb5-81" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-82"><a href="#cb5-82" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-83"><a href="#cb5-83" tabindex="-1"></a><span class="co">#&gt; $sendingReceiptToRespondent</span></span>
<span id="cb5-84"><a href="#cb5-84" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-85"><a href="#cb5-85" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-86"><a href="#cb5-86" tabindex="-1"></a><span class="co">#&gt; $receiptText</span></span>
<span id="cb5-87"><a href="#cb5-87" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-88"><a href="#cb5-88" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-89"><a href="#cb5-89" tabindex="-1"></a><span class="co">#&gt; $editorsSubmissionEmailType</span></span>
<span id="cb5-90"><a href="#cb5-90" tabindex="-1"></a><span class="co">#&gt; [1] &quot;NONE&quot;</span></span>
<span id="cb5-91"><a href="#cb5-91" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-92"><a href="#cb5-92" tabindex="-1"></a><span class="co">#&gt; $editorsSubmissionEmails</span></span>
<span id="cb5-93"><a href="#cb5-93" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-94"><a href="#cb5-94" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-95"><a href="#cb5-95" tabindex="-1"></a><span class="co">#&gt; $deliveryDestination</span></span>
<span id="cb5-96"><a href="#cb5-96" tabindex="-1"></a><span class="co">#&gt; [1] &quot;DATABASE&quot;</span></span>
<span id="cb5-97"><a href="#cb5-97" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-98"><a href="#cb5-98" tabindex="-1"></a><span class="co">#&gt; $emailInvitationText</span></span>
<span id="cb5-99"><a href="#cb5-99" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-100"><a href="#cb5-100" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-101"><a href="#cb5-101" tabindex="-1"></a><span class="co">#&gt; $emailReminderText</span></span>
<span id="cb5-102"><a href="#cb5-102" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-103"><a href="#cb5-103" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-104"><a href="#cb5-104" tabindex="-1"></a><span class="co">#&gt; $automaticReminderIntervalInDays</span></span>
<span id="cb5-105"><a href="#cb5-105" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-106"><a href="#cb5-106" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-107"><a href="#cb5-107" tabindex="-1"></a><span class="co">#&gt; $recurringInvitationNumber</span></span>
<span id="cb5-108"><a href="#cb5-108" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-109"><a href="#cb5-109" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-110"><a href="#cb5-110" tabindex="-1"></a><span class="co">#&gt; $recurringInvitationIntervalInDays</span></span>
<span id="cb5-111"><a href="#cb5-111" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-112"><a href="#cb5-112" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-113"><a href="#cb5-113" tabindex="-1"></a><span class="co">#&gt; $tsdPgpPublicKeyFingerprint</span></span>
<span id="cb5-114"><a href="#cb5-114" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-115"><a href="#cb5-115" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-116"><a href="#cb5-116" tabindex="-1"></a><span class="co">#&gt; $editorCryptKeyDatabaseEncrypted</span></span>
<span id="cb5-117"><a href="#cb5-117" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-118"><a href="#cb5-118" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-119"><a href="#cb5-119" tabindex="-1"></a><span class="co">#&gt; $editorCryptKeyDatabaseEncryptedFingerprint</span></span>
<span id="cb5-120"><a href="#cb5-120" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-121"><a href="#cb5-121" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-122"><a href="#cb5-122" tabindex="-1"></a><span class="co">#&gt; $editors</span></span>
<span id="cb5-123"><a href="#cb5-123" tabindex="-1"></a><span class="co">#&gt; $editors[[1]]</span></span>
<span id="cb5-124"><a href="#cb5-124" tabindex="-1"></a><span class="co">#&gt; $editors[[1]]$personId</span></span>
<span id="cb5-125"><a href="#cb5-125" tabindex="-1"></a><span class="co">#&gt; [1] 58096</span></span>
<span id="cb5-126"><a href="#cb5-126" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-127"><a href="#cb5-127" tabindex="-1"></a><span class="co">#&gt; $editors[[1]]$username</span></span>
<span id="cb5-128"><a href="#cb5-128" tabindex="-1"></a><span class="co">#&gt; [1] &quot;athanasm@uio.no&quot;</span></span>
<span id="cb5-129"><a href="#cb5-129" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-130"><a href="#cb5-130" tabindex="-1"></a><span class="co">#&gt; $editors[[1]]$name</span></span>
<span id="cb5-131"><a href="#cb5-131" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Athanasia Monika Mowinckel&quot;</span></span>
<span id="cb5-132"><a href="#cb5-132" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-133"><a href="#cb5-133" tabindex="-1"></a><span class="co">#&gt; $editors[[1]]$email</span></span>
<span id="cb5-134"><a href="#cb5-134" tabindex="-1"></a><span class="co">#&gt; [1] &quot;a.m.mowinckel@psykologi.uio.no&quot;</span></span>
<span id="cb5-135"><a href="#cb5-135" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-136"><a href="#cb5-136" tabindex="-1"></a><span class="co">#&gt; $editors[[1]]$type</span></span>
<span id="cb5-137"><a href="#cb5-137" tabindex="-1"></a><span class="co">#&gt; [1] &quot;LOCAL&quot;</span></span>
<span id="cb5-138"><a href="#cb5-138" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-139"><a href="#cb5-139" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-140"><a href="#cb5-140" tabindex="-1"></a><span class="co">#&gt; $editors[[2]]</span></span>
<span id="cb5-141"><a href="#cb5-141" tabindex="-1"></a><span class="co">#&gt; $editors[[2]]$personId</span></span>
<span id="cb5-142"><a href="#cb5-142" tabindex="-1"></a><span class="co">#&gt; [1] 132</span></span>
<span id="cb5-143"><a href="#cb5-143" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-144"><a href="#cb5-144" tabindex="-1"></a><span class="co">#&gt; $editors[[2]]$username</span></span>
<span id="cb5-145"><a href="#cb5-145" tabindex="-1"></a><span class="co">#&gt; [1] &quot;areg@uio.no&quot;</span></span>
<span id="cb5-146"><a href="#cb5-146" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-147"><a href="#cb5-147" tabindex="-1"></a><span class="co">#&gt; $editors[[2]]$name</span></span>
<span id="cb5-148"><a href="#cb5-148" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Are Dag Gulbrandsen&quot;</span></span>
<span id="cb5-149"><a href="#cb5-149" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-150"><a href="#cb5-150" tabindex="-1"></a><span class="co">#&gt; $editors[[2]]$email</span></span>
<span id="cb5-151"><a href="#cb5-151" tabindex="-1"></a><span class="co">#&gt; [1] &quot;areg@uio.no&quot;</span></span>
<span id="cb5-152"><a href="#cb5-152" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-153"><a href="#cb5-153" tabindex="-1"></a><span class="co">#&gt; $editors[[2]]$type</span></span>
<span id="cb5-154"><a href="#cb5-154" tabindex="-1"></a><span class="co">#&gt; [1] &quot;LOCAL&quot;</span></span>
<span id="cb5-155"><a href="#cb5-155" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-156"><a href="#cb5-156" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-157"><a href="#cb5-157" tabindex="-1"></a><span class="co">#&gt; $editors[[3]]</span></span>
<span id="cb5-158"><a href="#cb5-158" tabindex="-1"></a><span class="co">#&gt; $editors[[3]]$personId</span></span>
<span id="cb5-159"><a href="#cb5-159" tabindex="-1"></a><span class="co">#&gt; [1] 3439404</span></span>
<span id="cb5-160"><a href="#cb5-160" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-161"><a href="#cb5-161" tabindex="-1"></a><span class="co">#&gt; $editors[[3]]$username</span></span>
<span id="cb5-162"><a href="#cb5-162" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ccda25ce-8256-4c6f-ba71-7a4357dc6caf@apiclient&quot;</span></span>
<span id="cb5-163"><a href="#cb5-163" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-164"><a href="#cb5-164" tabindex="-1"></a><span class="co">#&gt; $editors[[3]]$name</span></span>
<span id="cb5-165"><a href="#cb5-165" tabindex="-1"></a><span class="co">#&gt; [1] &quot;nettskjemar&quot;</span></span>
<span id="cb5-166"><a href="#cb5-166" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-167"><a href="#cb5-167" tabindex="-1"></a><span class="co">#&gt; $editors[[3]]$email</span></span>
<span id="cb5-168"><a href="#cb5-168" tabindex="-1"></a><span class="co">#&gt; [1] &quot;athanasm@uio.no&quot;</span></span>
<span id="cb5-169"><a href="#cb5-169" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-170"><a href="#cb5-170" tabindex="-1"></a><span class="co">#&gt; $editors[[3]]$type</span></span>
<span id="cb5-171"><a href="#cb5-171" tabindex="-1"></a><span class="co">#&gt; [1] &quot;API_CLIENT&quot;</span></span>
<span id="cb5-172"><a href="#cb5-172" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-173"><a href="#cb5-173" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-174"><a href="#cb5-174" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-175"><a href="#cb5-175" tabindex="-1"></a><span class="co">#&gt; $personsWithCopyPermission</span></span>
<span id="cb5-176"><a href="#cb5-176" tabindex="-1"></a><span class="co">#&gt; list()</span></span>
<span id="cb5-177"><a href="#cb5-177" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-178"><a href="#cb5-178" tabindex="-1"></a><span class="co">#&gt; $netgroupsEditor</span></span>
<span id="cb5-179"><a href="#cb5-179" tabindex="-1"></a><span class="co">#&gt; list()</span></span>
<span id="cb5-180"><a href="#cb5-180" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-181"><a href="#cb5-181" tabindex="-1"></a><span class="co">#&gt; $netgroupsWithCopyPermission</span></span>
<span id="cb5-182"><a href="#cb5-182" tabindex="-1"></a><span class="co">#&gt; list()</span></span>
<span id="cb5-183"><a href="#cb5-183" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-184"><a href="#cb5-184" tabindex="-1"></a><span class="co">#&gt; $consentForm</span></span>
<span id="cb5-185"><a href="#cb5-185" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-186"><a href="#cb5-186" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-187"><a href="#cb5-187" tabindex="-1"></a><span class="co">#&gt; $randomizedOrder</span></span>
<span id="cb5-188"><a href="#cb5-188" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-189"><a href="#cb5-189" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-190"><a href="#cb5-190" tabindex="-1"></a><span class="co">#&gt; $supportuser</span></span>
<span id="cb5-191"><a href="#cb5-191" tabindex="-1"></a><span class="co">#&gt; $supportuser$theme</span></span>
<span id="cb5-192"><a href="#cb5-192" tabindex="-1"></a><span class="co">#&gt; [1] &quot;DEFAULT&quot;</span></span>
<span id="cb5-193"><a href="#cb5-193" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-194"><a href="#cb5-194" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-195"><a href="#cb5-195" tabindex="-1"></a><span class="co">#&gt; $superuser</span></span>
<span id="cb5-196"><a href="#cb5-196" tabindex="-1"></a><span class="co">#&gt; $superuser$afterDeliveryForwardUrl</span></span>
<span id="cb5-197"><a href="#cb5-197" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-198"><a href="#cb5-198" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-199"><a href="#cb5-199" tabindex="-1"></a><span class="co">#&gt; $superuser$afterDeliveryForwardCodebookValues</span></span>
<span id="cb5-200"><a href="#cb5-200" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-201"><a href="#cb5-201" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-202"><a href="#cb5-202" tabindex="-1"></a><span class="co">#&gt; $superuser$receiptPageScript</span></span>
<span id="cb5-203"><a href="#cb5-203" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-204"><a href="#cb5-204" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-205"><a href="#cb5-205" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-206"><a href="#cb5-206" tabindex="-1"></a><span class="co">#&gt; $isDictaphone</span></span>
<span id="cb5-207"><a href="#cb5-207" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-208"><a href="#cb5-208" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-209"><a href="#cb5-209" tabindex="-1"></a><span class="co">#&gt; $globalCopyPermissionEnabled</span></span>
<span id="cb5-210"><a href="#cb5-210" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb5-211"><a href="#cb5-211" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-212"><a href="#cb5-212" tabindex="-1"></a><span class="co">#&gt; $titleForLogging</span></span>
<span id="cb5-213"><a href="#cb5-213" tabindex="-1"></a><span class="co">#&gt; [1] &quot;\&quot;API test form\&quot; (id: 123823)&quot;</span></span></code></pre></div>
<p>Using the <code>resp_body_json()</code> function from httr2, will
automatically unpack the <code>json</code> into a R list-format, so we
can more easily work with it.</p>
<p>There are endpoints in the Nettskjema API that will not send
<code>json</code>, for instance the ones where you retrieve
<em>files</em> from the server (excel, SPSS, PDF), these come in
<em>binary</em> form. While, this package contains functions to retrieve
those specific files for you, we mention this because you will need to
pay attention to the format of the response to know how to unpack the
data correctly.</p>
</div>
<div id="setting-up-a-custom-post-request" class="section level2">
<h2>Setting up a custom POST request</h2>
<p>So far, we have focused on <code>GET</code> requests, which retrieve
information from the API. A <code>POST</code> request sends information
<em>to</em> the API for storing, and is a little more work. This is
because <code>POST</code> (or <code>PUT</code> or <code>PATCH</code>)
also send information in the “body” of the request, with the information
you want stored. You will need to know what format this information
should have, and how to set it up to make it work correctly. This can
require a lot of trial and error to get working correctly.</p>
<p>Since we now have the full settings for a form, let us change a
setting so we can see how to achieve this. There is an element that
controls if the user can postpone the survey as they are answering
it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>settings_data<span class="sc">$</span>postponable</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>For this form, it’s set to <code>FALSE</code> because its just a
simple test form I didn’t turn this feature on. We will turn it on by
setting the value to <code>TRUE</code>.</p>
<p>There are several things we need to pay particular attention to in
the documentation when we send these types of requests:</p>
<ol style="list-style-type: decimal">
<li>The METHOD (POST, PUT, PATCH)</li>
<li>The URL endpoint</li>
<li>The information we need to send</li>
</ol>
<p>For altering settings, these are:</p>
<ol style="list-style-type: decimal">
<li>PATCH</li>
<li>/api/v3/form/{formId}/settings</li>
<li><code>additionalProperty = string</code></li>
</ol>
<p>The first two bits were easy enough to figure out, but the last one
there might require some trial and error. I’m not entirely sure what
it’s telling me the body contents should be, so I’ll be doing some
assumptions. Since its a <code>PATCH</code> method, and the docs is not
explicitly saying we need to send all settings, I’m hoping I can send
just the property I want to alter in a list (which httr2 will help me
turn into a json that API expects). Since the URL endpoints is the same
as when getting the settings, what we need to do it use the same
information, but change the method with httr2.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">ns_req</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">&quot;form&quot;</span>, formid, <span class="st">&quot;settings&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">req_method</span>(<span class="st">&quot;PATCH&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; &lt;httr2_request&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; PATCH https://nettskjema.no/api/v3/form/123823/settings</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; Body: empty</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; Policies:</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; * auth_sign : &lt;list&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; * auth_oauth: TRUE</span></span></code></pre></div>
<p>Ok, we can see now that the method is correct, the URL is correct,
but the body is empty.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">ns_req</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">&quot;form&quot;</span>, formid, <span class="st">&quot;settings&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">req_method</span>(<span class="st">&quot;PATCH&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">req_body_json</span>(</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>      <span class="at">postponable =</span> <span class="cn">TRUE</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    )</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  )</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; &lt;httr2_request&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; PATCH https://nettskjema.no/api/v3/form/123823/settings</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; Body: JSON data</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; Policies:</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; * auth_sign : &lt;list&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; * auth_oauth: TRUE</span></span></code></pre></div>
<p>Things look kind of correct now, we’re still not sure about the body
setup, but we will send the request and see what happens.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">ns_req</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">&quot;form&quot;</span>, formid, <span class="st">&quot;settings&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">req_method</span>(<span class="st">&quot;PATCH&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">req_body_json</span>(</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>      <span class="at">postponable =</span> <span class="cn">TRUE</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    )</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; Error in `req_perform()`:</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; ! HTTP 400 Bad Request.</span></span></code></pre></div>
<p>That didn’t work, but why? We’ve not got any further error message,
but there might be more information in the body of the response, even if
it erred. Erring API calls like these are actually valid proper
responses, so we can explore them just like normal responses. If you
didn’t store the response, like I did, you can still explore it without
doing the call again. httr2 has functionality to capture the last
response even after the fact!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">last_response</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">resp_body_json</span>()</span></code></pre></div>
<pre><code> #&gt; $message
#&gt; [1] &quot;Valideringsfeil&quot;
#&gt; 
#&gt; $errors
#&gt; $errors$postponable
#&gt; $errors$postponable[[1]]
#&gt; [1] &quot;Mellomlagring er bare tillatt for skjemaer med FEIDE-respondenter, er satt til å samle inn personopplysninger og som leverer til Nettskjema&quot;
#&gt; 
#&gt; 
#&gt; 
#&gt; $confirmForceCleanupErrors
#&gt; named list()</code></pre>
<p>As we can see, we get a nice clear message about what has erred. The
form I’m trying to change doesn’t meet the pre-requisites for allowing
postponing, so we cannot alter that setting!</p>
<p>We can try changing another setting in stead, but we have actually
already verified that our calls to the API is working as expected. We
can try altering two settings at once, and see what happens.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Show old settings</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>settings_data<span class="sc">$</span>personalDataPurposeDescription</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Testing the API&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>settings_data<span class="sc">$</span>shouldHideProgressBar</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Set new settings</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="fu">ns_req</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">&quot;form&quot;</span>, formid, <span class="st">&quot;settings&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>  <span class="fu">req_method</span>(<span class="st">&quot;PATCH&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  <span class="fu">req_body_json</span>(</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>      <span class="at">personalDataPurposeDescription =</span> <span class="st">&quot;Testing the API&quot;</span>,</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>      <span class="at">shouldHideProgressBar =</span> <span class="cn">TRUE</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    )</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>  <span class="fu">req_perform</span>()</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; &lt;httr2_response&gt;</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; PATCH https://nettskjema.no/api/v3/form/123823/settings</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt; Status: 204 No Content</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt; Body: None</span></span></code></pre></div>
<p>Now we are cooking, we are getting a 204 back, which is a positive <a href="https://www.webcron.org/en/http-codes">status code</a> from an
API. The response also says there is no content, and nothing in the
body, so there is nothing more to inspect here.</p>
<p>Lets retrieve the settings again and see if we can verify our selves
that the settings have indeed changed</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>settings_new <span class="ot">&lt;-</span> <span class="fu">ns_req</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">req_url_path_append</span>(<span class="st">&quot;form&quot;</span>, formid, <span class="st">&quot;settings&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">req_perform</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="fu">resp_body_json</span>()</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>settings_new<span class="sc">$</span>personalDataPurposeDescription</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Testing the API&quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>settings_new<span class="sc">$</span>shouldHideProgressBar</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We’ve now confirmed we have altered some settings in the test form.
Hopefully, this gives an idea of how you can build more custom requests
to the API.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
